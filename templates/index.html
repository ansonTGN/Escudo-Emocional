{% extends "base.html" %}
{% import "components.html" as forms %}

{% block title %}{{ t.title }}{% endblock title %}

{% block extra_css %}
<style>
    /* Estilos espec√≠ficos de Index */
    .tabs { display: flex; background: #222; border-radius: 8px; padding: 4px; margin-bottom: 10px; }
    .tab-btn { flex: 1; background: transparent; border: none; color: var(--text-muted); padding: 10px; border-radius: 6px; font-size: 0.85rem; }
    .tab-btn.active { background: #333; color: #fff; font-weight: 600; }
    
    .tab-panel.active { display: block !important; }

    .mode-switcher { display: flex; gap: 10px; margin-bottom: 15px; justify-content: center; }
    .mode-chip { padding: 10px 20px; border: 1px solid var(--border); border-radius: 20px; cursor: pointer; opacity: 0.6; font-size: 0.8rem; text-align: center; }
    .mode-chip.active { opacity: 1; border-color: var(--accent-gold); background: rgba(212, 175, 55, 0.1); color: var(--accent-gold); font-weight: bold; }

    .audio-box, .file-box { background: rgba(255,255,255,0.02); border: 1px dashed var(--border); border-radius: 8px; padding: 20px; }

    /* MENSAJE DE BIENVENIDA EMP√ÅTICO */
    .empathy-box {
        background: rgba(16, 185, 129, 0.05); /* Verde muy suave */
        border-left: 3px solid var(--accent-safe);
        padding: 15px;
        margin-bottom: 25px;
        border-radius: 0 8px 8px 0;
    }
    .empathy-text { font-size: 0.9rem; color: #ccc; font-style: italic; }

    /* GRID SENSORES DETALLADA (TARJETAS) */
    .sensor-container { margin-top: 25px; border-top: 1px solid #333; padding-top: 20px; }
    
    .sensor-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media(min-width: 700px) { .sensor-grid { grid-template-columns: 1fr 1fr; } }

    .sensor-card {
        background: #161616; border: 1px solid #333; border-radius: 8px; padding: 12px 15px;
        display: flex; justify-content: space-between; align-items: center; transition: border-color 0.2s;
    }
    .sensor-card:hover { border-color: #555; background: #1a1a1a; }
    
    .sensor-info { padding-right: 15px; flex: 1; }
    .sensor-title { color: #e2e8f0; font-size: 0.85rem; font-weight: 400; line-height: 1.3; }
    
    .sensor-select-wrapper { position: relative; }
    .sensor-select {
        appearance: none; -webkit-appearance: none; background: #000; color: var(--accent-gold);
        border: 1px solid #444; padding: 8px; border-radius: 6px; font-weight: bold;
        font-size: 1rem; width: 50px; text-align: center; cursor: pointer; margin: 0;
    }
    .sensor-select:focus { border-color: var(--accent-gold); outline: none; }

</style>
{% endblock extra_css %}

{% block content %}
<div class="container">
    
    {% include "partials/header.html" %}

    <div style="text-align: center; margin-bottom: 20px;">
        <h1 style="font-size: 1.5rem;">{{ t.title }}</h1>
        <div style="font-size: 0.7rem; color: #666; letter-spacing: 2px;">{{ t.subtitle }}</div>
    </div>

    <!-- SELECTOR DE MODO -->
    <div class="mode-switcher">
        <div id="btn-mode-defense" class="mode-chip active" onclick="setMode('defense')">üõ°Ô∏è {{ t.tab_motors }}</div>
        <div id="btn-mode-analysis" class="mode-chip" onclick="setMode('analysis')">üìä {{ t.tab_system }}</div>
    </div>

    <form id="main-form" action="/motors" method="post" enctype="multipart/form-data" onsubmit="document.getElementById('loader').style.display='flex'">
        <input type="hidden" name="lang" value="{{ lang }}">
        
        <div class="card">
            
            <!-- PANEL 1: DEFENSA (MODO EMP√ÅTICO) -->
            <div id="panel-defense">
                
                <!-- AYUDA VISIBLE -->
                <div class="empathy-box">
                    <div class="empathy-text">
                        {% if lang == 'es' %}
                        <strong>Nota:</strong> Es normal sentirse confundido/a. Si no sabes qu√© poner, usa el bot√≥n de üéôÔ∏è Audio y habla libremente. El sistema ordenar√° tus ideas. No necesitas ser preciso.
                        {% elif lang == 'cat' %}
                        <strong>Nota:</strong> √âs normal sentir-se conf√≥s/a. Si no saps qu√® posar, fes servir el bot√≥ de üéôÔ∏è √Äudio i parla lliurement. El sistema ordenar√† les teves idees.
                        {% else %}
                        <strong>Note:</strong> It's normal to feel confused. If you don't know what to write, use the üéôÔ∏è Audio button and speak freely. The system will organize your thoughts.
                        {% endif %}
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label>{{ t.lbl_target }}</label>
                        <input type="text" name="target_name" placeholder="Ej. Alex, Mi jefe, Mam√°...">
                    </div>
                    <div>
                        <label>{{ t.lbl_relation }}</label>
                        <select name="relationship">
                            <option value="peer">{{ t.rel_peer }}</option>
                            <option value="boss">{{ t.rel_boss }}</option>
                            <option value="team">{{ t.rel_team }}</option>
                            <option value="client">{{ t.rel_client }}</option>
                            <option value="provider">{{ t.rel_provider }}</option>
                            <option value="adversary">{{ t.rel_adversary }}</option>
                            <option value="regulator">{{ t.rel_regulator }}</option>
                            <option value="mentor">{{ t.rel_mentor }}</option>
                            <option value="other">{{ t.rel_other }}</option>
                        </select>
                    </div>
                </div>

                {{ forms::input_widget(id_prefix="m_context", label=t.lbl_m_context, placeholder=t.ph_m_context, t=t) }}
                {{ forms::input_widget(id_prefix="m_observations", label=t.lbl_m_obs, placeholder=t.ph_m_obs, t=t) }}
                
                <label>{{ t.lbl_m_goal }}</label>
                <textarea name="m_goal" rows="2" placeholder="{{ t.ph_m_goal }}"></textarea>

                <div class="sensor-container">
                    <label style="color: var(--accent-gold); font-size: 1rem; margin-bottom: 5px;">
                        {{ t.lbl_signals }}
                    </label>
                    <div style="font-size: 0.8rem; color: #888; margin-bottom: 20px; font-style: italic;">
                        {{ t.scale_desc }}
                    </div>
                    
                    <div class="sensor-grid">
                        <!-- INVOCACI√ìN DE LOS 10 SENSORES USANDO LA MACRO IMPORTADA -->
                        {{ forms::sensor_card(name="sig_curiosity", label=t.sig_curiosity) }}
                        {{ forms::sensor_card(name="sig_purpose",   label=t.sig_purpose) }}
                        
                        {{ forms::sensor_card(name="sig_status",    label=t.sig_status) }}
                        {{ forms::sensor_card(name="sig_belonging", label=t.sig_belonging) }}
                        
                        {{ forms::sensor_card(name="sig_autonomy",  label=t.sig_autonomy) }}
                        {{ forms::sensor_card(name="sig_control",   label=t.sig_control) }}
                        
                        {{ forms::sensor_card(name="sig_mastery",   label=t.sig_mastery) }}
                        {{ forms::sensor_card(name="sig_justice",   label=t.sig_justice) }}
                        
                        {{ forms::sensor_card(name="sig_security",  label=t.sig_security) }}
                        {{ forms::sensor_card(name="sig_comfort",   label=t.sig_comfort) }}
                    </div>
                </div>
            </div>

            <!-- PANEL 2: AN√ÅLISIS T√âCNICO -->
            <div id="panel-analysis" class="hidden">
                <div style="background: rgba(0,0,0,0.3); padding: 10px; margin-bottom: 20px; border-radius: 4px; border: 1px solid #444; font-size: 0.8rem; color: #aaa;">
                    ‚ö†Ô∏è Mode Expert: Useu aquest panell nom√©s per a an√†lisi sist√®mica (PESTEL, Incentius, Estrat√®gia corporativa).
                </div>
                {{ forms::input_widget(id_prefix="situation", label=t.lbl_situation, placeholder=t.ph_situation, t=t) }}
                {{ forms::input_widget(id_prefix="cv", label=t.lbl_cv, placeholder=t.ph_cv, t=t) }}
                
                <label>{{ t.lbl_focus }}</label>
                <textarea name="extra_questions" rows="2" placeholder="{{ t.ph_focus }}"></textarea>
            </div>

        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 18px; margin-top: 10px;">
            {{ t.btn_motors }}
        </button>
    </form>
</div>

{% include "partials/help_modal.html" %}

{% endblock content %}

{% block scripts %}
    {% include "partials/scripts.html" %}
{% endblock scripts %}
